<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- 
	000000book
	<canvas> GML playback with Processing.js, take 1
	Jamie Dubs <http://github.com/jamiew>
-->
<html>
<head>
	<title>canvasplayer: GML Playback using Processing.js</title>
	<style type="text/css" media="screen">
		body { background: #fff; color: #222; font-family: sans-serif; width: 810px; margin: 0 auto; text-align: center; }
		h1 { letter-spacing: -1px; color: #000; }
		h2 { font-family: "Arial", sans-serif; font-weight: normal; }
		a, a:hover { color: #995; }
		canvas { margin: 0 auto; background-color: #000; border: 5px solid #222; }
	</style>
</head>
<body>
	<h1>canvasplayer: GML Playback using Processing.js</h1>
  <canvas id="canvas" width="800" height="600"></canvas>
	<p>
		Code available at <a href="http://github.com/jamiew/canvasplayer">github.com/jamiew/canvasplayer</a>		
		&mdash; data from <a href="http://000000book.com">http://000000book.com</a></p>

	
	<!-- Our Code! -->
  <script id="sketch" type="text/javascript">

	// var gml = {};
	
	void setup() {
		console.log("setup()");
		console.log(gml);

		// setup our canvas
		size(800,600);
		frameRate(60);
		background(0);
		// smooth();

		// read the GML, loaded via the #000000book JSON callback below
		pts = []
		strokes = gml.tag.drawing.stroke;
		for(i in strokes){ 
			console.log('reading stroke '+i);
			pts = pts.concat(strokes[i].pt);
			//blank array in b/w strokes 
			pts.push(undefined); 
		}
	}

	// TODO: use the time data instead of just doing continuous playback
	void draw() {		
		
		i = frameCount % pts.length;
		prev = pts[i-1];
		pt = pts[i];
		
		// clear on restart (first frame)
		if(i == 0){ background(0); }

		// if missing current pt, we are skipping
		if(pt == undefined || pt == []){ return; }
		
		// if missing the prev, we're at the beginning of a new stroke
		if(prev == undefined || prev == []){ prev = pt; }		
		
		// calculations
		dimx = (prev.x -pt.x)*width;
		dimy = (prev.y -pt.y)*height;
		hyp = 1/(sqrt(pow(dimx,2),pow(dimy,2)) + 25);

		// a manual from-iPhone transformation; TODO: should read this from the GML!
		translate(0, 750);
		rotate(80);

		// Finally... draw!
		// console.log('stroke prev.x='+prev.x+' prev.y='+prev.y+' pt.x='+pt.x+' pt.y='+pt.y+' |  dimx='+dimx+' dimy='+dimy+' hyp='+hyp);
		strokeWeight(hyp * 200);
		stroke(255);		
		line(prev.x*width, prev.y*height, pt.x*width, pt.y*height);

	}
  </script>  
		
	<!-- Sketch Initializer -->
  <!--<script>(function(){
		var init = function(){ var canvas=document.getElementById("canvas");var sketch=document.getElementById("sketch").text;Processing(canvas,sketch); }
	  /*addEventListener("DOMContentLoaded", init, false);*/
	})();</script>-->
  <script src="processing.min.js" type="text/javascript" charset="utf-8"></script>
	
	
	<!-- the GML data, served from #000000book and initialized in a callback -->
	<script type="text/javascript" charset="utf-8">
		function load_gml(data){
			gml = data.gml;
			console.log("load_gml()");
			console.log(gml);
			var canvas = document.getElementById("canvas"); 
			var sketch = document.getElementById("sketch").text; 
			var p = Processing(canvas, sketch, gml); 
		};
	</script>
	<script src="http://000000book.com/data/148.json?callback=load_gml" type="text/javascript" charset="utf-8"></script>
	
	
</body>
</html>